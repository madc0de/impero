repository: git@github.com:pckg-app/impero.git
branch: master

settings:
  sync: manual
  orchestration: manual

system:
  _default:
    image: schtr4jh/pckg-web-dynamic:latest

resources:

  database:
    system: database
    mysql:
      type: search
      name: pckg_impero
      user:
        pckg_impero: basic

  queue:
    system: queue
    rabbitmq:
      vhost: mailo

services:

  web:
    system: web
    https: true

  cron:
    system: cron
    command: php $webDirconsole cron:run >> $logsDircron.log

checkout:
  type: standalone

init:
  - composer install --no-dev --prefer-dist --no-progress --no-suggest --optimize-autoloader --ignore-platform-reqs
  - yarn install --production --silent

prepare:
  # chown to www-data:impero
  - sudo chown www-data:impero . -R

  # chown storage to www-data
  - sudo chown www-data:www-data storage -R

deploy:
  # pull changes
  - git pull --ff

  # install dependency changes
  - composer install --no-dev --prefer-dist --no-progress --no-suggest --optimize-autoloader --ignore-platform-reqs
  - yarn install --production --silent

migrate:
  # import translations
  #- php console $app translator:import

  # import generic data
  #- php console $app generic:import-actions
  #- php console $app generic:import-lists

  # clear cache
  - php $webDirconsole cache:clear

  # install migrations
  - php $webDirconsole $app migrator:install --repository=default --fields --yes --clear
  - php $webDirconsole $app migrator:install --repository=default --indexes --yes --clear

  # upgrade slugs
  # - php console $app translator:upgrade-slugs

  # clear cache
  - php $webDirconsole cache:clear